---
title: "Лабораторная работа №1"
author: "Бессмертная М.М."
date: "13 11 2020"
output: word_document
---

```{r setup, include=FALSE}
library(Hmisc)
library(knitr)
library(corrplot)
knitr::opts_chunk$set(echo = TRUE)
```

# Раздел 1.
В этом разделе необходимо собрать данные по социально-экономическим показателям в регионах РФ и изучить их взаимосвязи.

# **Необходимо построить:**

* Фактические плотности распределения переменных с наложенными теоретическими плотностями нормального закона (разместить графики на одном полотне).

* Тест Шапиро-Уилка на нормальность: таблица со статистикой теста, P-значением и выводом по каждой переменной.

* Точечные графики взаимного разброса, только над главной диагональю, сделать маркеры полупрозрачными.

* Взаимосвязь показателей: графическое представление корреляционной матрицы. Незначимые коэффициенты корреляции скрыть, остальные показать квадратами.

## Обозначение показателей:
* *RTPC.2017* - Оборот розничной торговли на душу населения в 2017 году, рублей.

* *SBP.2017* - Число малых предприятий на 10000 человек населения в 2017 году, шт.

* *UPCO.2017* - Использование информационных и коммуникационных технологий в организациях: персональные компьютеры в 2017 году, в процентах от общего числа обследованных организаций.

* *CBE.2016* - Расходы консолидированных бюджетов субъектов Российской Федерации в 2016 году: всего, млн.руб.

* *RIOP.2017* - Реальные денежные доходы населения в 2017 году, в процентах к предыдущему году.

```{r import, echo = FALSE}
DF <- read.csv("Bessmertnaya.csv",stringsAsFactors = F,sep =";")
reg.df = DF[, -1]
reg.df = na.omit(reg.df)
```

## Описательная статистика

```{r reg.df, echo = FALSE}
# Среднее арифметическое
mns <- round(apply(reg.df[, 1:5], 2, mean), 1)
# Стандартные оклонения
sds <- round(apply(reg.df[, 1:5], 2, sd), 1)
# Коэффициенты вариации
coef.vars <- round(sds/mns*100, 1)
smm <- rbind(mns, sds, coef.vars)
rownames(smm) <- c('Среднее', 'Стандартное отклонение', 'Коэффициент вариации, %')
kable(smm)
```

## Анализ распределния данных

Построим гистограммы с их фактическими плотностями распределений и наложим сверху теоретическую нормальную плотность распределения.


```{r, echo = FALSE}
# строим гистограммы на одном полотне по изначальным данным
par(mfrow = c(3, 2))           # разбить полотно на 6 частей, 2x3
par(oma = c(0, 0, 1.5, 0))     # внешние поля общего полотна
par(mar = c(4, 4, 0.5, 0.5))   # внутренние поля каждого графика
# цикл по номерам столбцов с количественными переменными
for (i in 1:5) {
  # данные -- i-ый столбец фрейма
  x <- reg.df[, i]
  
  # гистограмма
  hist(x,
       freq = F,            # по вертикали – плотность (доля)
       col = 'wheat',       # цвет заливки
       xlab = colnames(reg.df)[i],     # название оси X – название столбца 
       ylab = 'Плотность',             # название оси Y
       main = '',
       ylim=c(0,max(density(x)$y)))                      # без заголовка
  
  #фактическая плотность
  lines(density(x),col = "red", lwd = 2)
  
  # теоретическая плотность
  curve(dnorm(x, mean = mean(x), sd = sd(x)), col = 'darkblue', 
        lwd = 2, add = TRUE)
}
# общий заголовок для всех графиков
title(main = 'Гистограммы распределения показателей', 
      outer = TRUE, cex = 1.5)
# вернуть настройки обратно, 1x1
par(mfrow = c(1, 1))
```

**Вывод:** При визуальной оценке графиков распределения показателей мы можем предположить, что переменные *'RTPC.2017'*, *'SBP.2017'*, *'UPCO.2017'*, *'RIOP.2017'*, *'CBE.2016'* не имеют нормального распределения.

## Тест Шапиро-Уилка на нормальность

```{r Shapiro,echo = FALSE}
a <- apply(reg.df, 2, function (x) { round(shapiro.test(x)$statistic, 5)})
b <- apply(reg.df, 2, function (x) { round(shapiro.test(x)$p.value, 5)})
shap <- rbind(a,b)
rownames(shap) <- c('Статистика','P-значение')
kable(shap)
```

**Вывод:** По итогам теста Шапиро-Уилка на нормальность распредления переменных (при уровне значимости 0,05) отвергается нулевая гипотеза о нормальности распределения для всех пяти показателей *'RTPC.2017'*, *'SBP.2017'*, *'UPCO.2017'*, *'RIOP.2017'*, *'CBE.2016'*, т.к. P-значения < 0.05. Следовательно, данные не имеют нормального распределения.

## Анализ взаимосвязей показателей
### Графики разброса

```{r,echo = FALSE, fig.width = 6, fig.height = 5}
pairs(reg.df, pch = 16, col = rgb(0.8, 0, 0, alpha = 0.4), bg = rgb(0.8, 0, 0, alpha = 0.4), cex = 1.4, lower.panel = NULL)

```

### Корреляционная матрица

```{r, echo = FALSE}
# коэффициенты Пирсона с P-значениями
r.corr <- rcorr(as.matrix(reg.df))
# Визуализация корреляционной матрицы  =========================================
# сохраняем корреляционную матрицу
matrix.cor <- r.corr$r
# сохраняем p-значения
matrix.p <- r.corr$P
# изображаем матрицу графически
corrplot(matrix.cor,          # сама корреляционная матрица
         method = 'square',   # квадратики
         order = 'original',  # порядок отображения показателей 
         # в матрице
         diag = F,            # не отображать значения на главной диагонали
         p.mat = matrix.p,    # p-значения
         insig = 'blank',     # метод отображения незначимых
         sig.level = 0.05)    # уровень значимости
title(ylab = 'Корреляция показателей')
```

**Вывод:** На основании корредяционной матрицы мы можем сделать вывод, что между показателями *'RTCP.2017'* и *'CBE.2016'* наблюдается сильная прямая корредяционная зависимость. Между показателями *'CBE.2016'* и *'SBP.2017'* наблюдается заметная прямая корреляционная зависимость. Между показателями *'RTCP.2017'* и *'SBP.2017'* прямая умеренная связь.


# Раздел 2.

В этом разделе необходимо произвести теже самые действия, с логарифмированными исходными данными.

## Описательная статистика логарифмированных данных:

```{r, echo = FALSE}
reg.df1 <- log(reg.df)
```

```{r reg.df1, echo = FALSE}
# Среднее арифметическое
mns1 <- round(apply(reg.df1[, 1:5], 2, mean), 1)
# Стандартные оклонения
sds1 <- round(apply(reg.df1[, 1:5], 2, sd), 1)
# Коэффициенты вариации
coef.vars1 <- round(sds1/mns1*100, 1)
smm1 <- rbind(mns1, sds1, coef.vars1)
rownames(smm1) <- c('Среднее', 'Стандартное отклонение', 'Коэффициент вариации, %')
knitr::kable(smm1)
```

## Анализ распределния логарифмированных данных

Построим гистограммы логарифмированных данных с их фактическими плотностями распределений и наложим сверху теоретическую нормальную плотность распределения.

```{r, echo = FALSE}
# строим гистограммы на одном полотне по изначальным данным
par(mfrow = c(3, 2))           # разбить полотно на 6 частей, 2x3
par(oma = c(0, 0, 1.5, 0))     # внешние поля общего полотна
par(mar = c(4, 4, 0.5, 0.5))   # внутренние поля каждого графика
# цикл по номерам столбцов с количественными переменными
for (i in 1:5) {
  # данные -- i-ый столбец фрейма
  x <- reg.df1[, i]
  
  # гистограмма
  hist(x,
       freq = F,            # по вертикали – плотность (доля)
       col = 'wheat',       # цвет заливки
       xlab = colnames(reg.df)[i],     # название оси X – название столбца 
       ylab = 'Плотность',             # название оси Y
       main = '',
       ylim=c(0,max(density(x)$y)))                      # без заголовка
  
  #фактическая плотность
  lines(density(x),col = "red", lwd = 2)
  
  # теоретическая плотность
  curve(dnorm(x, mean = mean(x), sd = sd(x)), col = 'darkblue', 
        lwd = 2, add = TRUE)
}
# общий заголовок для всех графиков
title(main = 'Гистограммы распределения показателей', 
      outer = TRUE, cex = 1.5)
# вернуть настройки обратно, 1x1
par(mfrow = c(1, 1))
```

**Вывод:** При визуальном анализе графиков мы можем предположить, что нормированные данные по показателям *'RIOP.2017'* и *'CBE.2016'* имеют распределение, близкое к нормальному.

## Тест Шапиро-Уилка на нормальность для логарифмированных данных

```{r Shapiro1, echo = FALSE}
a1 <- apply(reg.df1, 2, function (x1) { round(shapiro.test(x1)$statistic, 5)})
b1 <- apply(reg.df1, 2, function (x1) { round(shapiro.test(x1)$p.value, 5)})
shap1 <- rbind(a1,b1)
rownames(shap1) <- c('Статистика','P-значение')
kable(shap1)
```
**Вывод:** По итогам теста Шапиро-Уилка на нормальность распредления логарифмированных переменных (при уровне значимости 0,05) отвергается нулевая гипотеза о нормальности распределения для четырех переменных *'RTPC.2017'*, *'SBP.2017'*, *'UPCO.2017'*, *'RIOP.2017'* т.к. P-значения < 0.05. А для переменной *'CBE.2016'* нулевая гипотеза принимается. Следовательно, нормированные данные по показателю имеют нормальное распределение.


## Анализ взаимосвязей логарифмированных показателей
### Графики разброса логарифмированных величин

```{r,echo = FALSE, fig.width = 6, fig.height = 5}
pairs(reg.df1, pch = 21, col = rgb(0, 0, 0.8, alpha = 0.4), bg = rgb(0, 0, 0.8, alpha = 0.4), cex = 1.4, lower.panel = NULL)

```


```{r, echo = FALSE}
# коэффициенты Пирсона с P-значениями
r.corr1 <- rcorr(as.matrix(reg.df1))

# сохраняем корреляционную матрицу
matrix.cor1 <- r.corr1$r
# сохраняем p-значения
matrix.p1 <- r.corr1$P
# изображаем матрицу графически
corrplot(matrix.cor1,
         method = 'square',
         order = 'original',  # порядок отображения показателей В матрице
         diag = F,            # не отображать значения на главной диагонали
         p.mat = matrix.p1,    # p-значения
         insig = 'blank',     # метод отображения незначимых
         sig.level = 0.05)    # уровень значимости
title(ylab = 'Корреляция показателей')
```

**Вывод:** На основании корредяционной матрицы мы можем сделать вывод, что между нормарованными показателями *'RTCP.2017'* и *'CBE.2016'* наблюдается сильная прямая корредяционная зависимость. Между показателями *'CBE.2016'* и *'SBP.2017'* наблюдается умеренная прямая корреляционная зависимость. Между показателями *'RTCP.2017'* и *'SBP.2017'* заметная прямая связь.



```{r, echo = FALSE}
# Сохраняем рабочее пространство
rm(smm, coef.vars, sds, mns, matrix.cor, matrix.p , shap, a, b)
rm(smm1, coef.vars1, sds1, mns1, matrix.cor1, matrix.p1, shap1, a1, b1)
save.image('Data.RData')
```




